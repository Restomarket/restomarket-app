# =============================================================================
# PRODUCTION ENVIRONMENT TEMPLATE
# =============================================================================
# This file provides guidance for production deployment
# DO NOT commit this file with real values - use a secrets manager
#
# Secrets Manager Options:
#   - AWS Secrets Manager
#   - HashiCorp Vault
#   - Azure Key Vault
#   - Google Secret Manager
#   - Kubernetes Secrets
#
# Generate secrets with: openssl rand -base64 <bytes>
# =============================================================================

# =============================================================================
# Application Configuration
# =============================================================================
NODE_ENV=production
APP_NAME=restomarket-api
APP_PORT=3002
APP_HOST=0.0.0.0
API_PREFIX=api
API_VERSION=1
REQUEST_TIMEOUT=30000

# =============================================================================
# Database Configuration - Supabase Production
# =============================================================================
# Pooler connection (port 6543) - for application runtime
# ⚠️  CRITICAL: Replace PROJECT_REF and PASSWORD with real values
DATABASE_URL=postgresql://postgres.PROJECT_REF:PASSWORD@aws-0-eu-central-1.pooler.supabase.com:6543/postgres?sslmode=require

# Direct connection (port 5432) - for migrations only
# ⚠️  CRITICAL: Replace PROJECT_REF and PASSWORD with real values
DATABASE_DIRECT_URL=postgresql://postgres.PROJECT_REF:PASSWORD@aws-0-eu-central-1.pooler.supabase.com:5432/postgres?sslmode=require

# Connection pool settings (tune based on load)
DATABASE_POOL_MAX=20
DATABASE_IDLE_TIMEOUT=20
DATABASE_CONNECT_TIMEOUT=10
DATABASE_SSL=true  # Required for Supabase

# Supabase project info
# ⚠️  CRITICAL: Replace with your production project values
SUPABASE_PROJECT_REF=your-prod-project-ref
SUPABASE_URL=https://your-prod-project-ref.supabase.co
SUPABASE_ANON_KEY=your-production-supabase-anon-key

# =============================================================================
# Better Auth Configuration
# =============================================================================
# ⚠️  CRITICAL: Generate with: openssl rand -base64 32
# Must be at least 32 characters
# Must match the secret in Next.js app
# Rotate every 90 days
BETTER_AUTH_SECRET=<GENERATE_WITH_OPENSSL_RAND_BASE64_32>

# Base URL for authentication callbacks (Next.js app URL)
# ⚠️  CRITICAL: Replace with your production domain
BETTER_AUTH_URL=https://app.restomarket.com

# =============================================================================
# Application URLs
# =============================================================================
# ⚠️  CRITICAL: Replace with your production domains
NEXT_PUBLIC_APP_URL=https://app.restomarket.com
NEXT_PUBLIC_API_URL=https://api.restomarket.com/v1

# =============================================================================
# Logging Configuration
# =============================================================================
# Production: use 'warn' or 'error' to reduce log volume
LOG_LEVEL=warn
# Production: always false (use structured JSON logs)
LOG_PRETTY=false

# =============================================================================
# Security Configuration
# =============================================================================
# Allowed CORS origins (comma-separated, no spaces)
# ⚠️  CRITICAL: Replace with your production domains
CORS_ORIGINS=https://app.restomarket.com,https://admin.restomarket.com

# Rate limiting (requests per minute)
# Tune based on expected traffic
RATE_LIMIT_TTL=60
RATE_LIMIT_MAX=100

# =============================================================================
# Swagger Configuration
# =============================================================================
# ⚠️  CRITICAL: Always false in production (security risk)
SWAGGER_ENABLED=false
SWAGGER_TITLE=RestoMarket API
SWAGGER_DESCRIPTION=B2B Food Supply Platform API
SWAGGER_VERSION=1.0

# =============================================================================
# Redis Configuration
# =============================================================================
# Redis connection URL for BullMQ and caching
# ⚠️  CRITICAL: Use secure connection with password and TLS
# Format: rediss://:password@host:6380 (note: rediss with double 's' for TLS)
# If using Redis Cloud, AWS ElastiCache, or similar:
REDIS_URL=rediss://:your-production-redis-password@your-redis-host:6380

# Alternative formats:
# AWS ElastiCache (with TLS):
# REDIS_URL=rediss://master.your-cluster.cache.amazonaws.com:6380
# Redis Cloud:
# REDIS_URL=rediss://:password@redis-12345.c123.us-east-1-2.ec2.cloud.redislabs.com:12345

# =============================================================================
# ERP Sync Configuration
# =============================================================================
# Agent authentication secret (shared with ERP agents)
# ⚠️  CRITICAL: Generate with: openssl rand -base64 24
# Minimum 16 characters, recommended 24+
# Rotate every 90 days
# Coordinate rotation with all ERP agents
AGENT_SECRET=<GENERATE_WITH_OPENSSL_RAND_BASE64_24>

# API key for admin endpoints (internal use only)
# ⚠️  CRITICAL: Generate with: openssl rand -base64 48
# Minimum 32 characters, recommended 48+
# Rotate every 90 days
# Store in secrets manager, never expose publicly
API_SECRET=<GENERATE_WITH_OPENSSL_RAND_BASE64_48>

# Slack webhook for sync alerts (optional but recommended)
# Create webhook at: https://api.slack.com/messaging/webhooks
# ⚠️  OPTIONAL: Remove if not using Slack alerts
SLACK_WEBHOOK_URL=https://hooks.slack.com/services/YOUR/PRODUCTION/WEBHOOK

# BullMQ job concurrency (1-20)
# Tune based on server resources and load
# Higher values = more parallel job processing
# Monitor memory and CPU usage when increasing
BULLMQ_CONCURRENCY=10

# =============================================================================
# DEPLOYMENT CHECKLIST
# =============================================================================
# Before deploying to production:
#
# [ ] Generate all secrets with cryptographically secure methods (openssl)
# [ ] Store secrets in a secrets manager (AWS, Vault, etc.)
# [ ] Rotate secrets every 90 days
# [ ] Configure monitoring and alerting (Slack webhook)
# [ ] Set up database backups (Supabase handles this)
# [ ] Configure Redis persistence and backups
# [ ] Enable TLS/SSL for all connections (database, Redis)
# [ ] Set CORS_ORIGINS to only trusted domains
# [ ] Set SWAGGER_ENABLED=false
# [ ] Set LOG_LEVEL=warn or error
# [ ] Set LOG_PRETTY=false
# [ ] Configure rate limiting based on expected traffic
# [ ] Test secret rotation process in staging first
# [ ] Document all secrets in a secure location
# [ ] Set up audit logging for secret access
# [ ] Configure firewall rules for database and Redis
# [ ] Enable container security scanning
# [ ] Set up log aggregation (CloudWatch, Datadog, etc.)
# [ ] Configure health check endpoints for load balancer
# [ ] Test disaster recovery procedures
# [ ] Document incident response procedures
#
# =============================================================================
# SECURITY REMINDERS
# =============================================================================
# 1. NEVER commit this file with real values
# 2. Use environment variables or secrets manager
# 3. Rotate all secrets every 90 days
# 4. Use unique secrets per environment (dev/staging/prod)
# 5. Grant secret access on a need-to-know basis
# 6. Audit secret access regularly
# 7. Test secret rotation in staging first
# 8. Monitor for leaked secrets (use scripts/check-secrets.sh)
# 9. Enable audit logging for all secret access
# 10. Have an incident response plan for secret leaks
#
# =============================================================================
# USEFUL COMMANDS
# =============================================================================
# Generate Better Auth secret:
#   openssl rand -base64 32
#
# Generate Agent secret:
#   openssl rand -base64 24
#
# Generate API secret:
#   openssl rand -base64 48
#
# Generate all at once:
#   echo "BETTER_AUTH_SECRET=$(openssl rand -base64 32)"
#   echo "AGENT_SECRET=$(openssl rand -base64 24)"
#   echo "API_SECRET=$(openssl rand -base64 48)"
#
# Test database connection:
#   psql "$DATABASE_URL"
#
# Test Redis connection:
#   redis-cli -u "$REDIS_URL" ping
#
# Check for leaked secrets:
#   bash scripts/check-secrets.sh
#
# Validate environment variables:
#   pnpm turbo build --filter=@apps/api
#
# =============================================================================
